<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TVStream ID</title>
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Konfigurasi Tailwind -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#ef4444',
                        dark: '#0f172a',
                        darker: '#020617',
                        card: '#1e293b',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* CSS Reset & Scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; } /* Hilangkan scrollbar */
        body { 
            background-color: #020617; 
            color: #f8fafc; 
            font-family: sans-serif; 
            overflow-x: hidden; 
            -webkit-tap-highlight-color: transparent; 
            overscroll-behavior-y: none;
        }

        /* Glassmorphism */
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }

        /* Loader */
        .loader { border: 3px solid rgba(255,255,255,0.1); border-left-color: #3b82f6; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* PLAYER OVERLAY FIXES - CRITICAL */
        #playerOverlay {
            background-color: #000;
            z-index: 9999;
            /* Fix untuk Mobile Browser Address Bar */
            height: 100dvh; 
            height: -webkit-fill-available; 
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        /* Force iframe to fill container completely */
        #tvFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            border: none;
            overflow: hidden;
        }

        /* Channel Card Hover */
        .channel-card { transition: all 0.2s ease; }
        .channel-card:active { transform: scale(0.98); }
        
        /* Helper untuk menyembunyikan scroll saat main */
        body.no-scroll {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass h-14 flex items-center justify-between px-4 transition-all">
        <div class="flex items-center gap-2 cursor-pointer" onclick="app.goHome()">
            <div class="w-7 h-7 rounded bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-sm">
                <i class="fas fa-tv"></i>
            </div>
            <h1 class="text-lg font-bold text-white hidden sm:block">TVStream</h1>
        </div>
        <div id="clock" class="text-xs text-slate-400 font-mono bg-slate-800/50 px-2 py-1 rounded">00:00</div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow pt-20 pb-24 px-4 max-w-5xl mx-auto w-full min-h-screen">
        <!-- Loader -->
        <div id="globalLoader" class="fixed inset-0 z-[60] bg-darker flex flex-col items-center justify-center">
            <div class="loader mb-4"></div>
            <p class="text-slate-500 text-xs">Memuat Channel...</p>
        </div>
        
        <!-- Content Container -->
        <div id="appContent" class="opacity-0 transition-opacity duration-500"></div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-4 py-3 rounded-full shadow-lg z-[100] transition-all translate-y-20 opacity-0 text-xs border border-slate-700 flex items-center gap-2 max-w-[90%] text-center">
        <i class="fas fa-info-circle text-blue-400"></i> <span id="toastMsg">Notifikasi</span>
    </div>

    <!-- Player Overlay (Cinema Mode) -->
    <div id="playerOverlay" class="hidden flex-col w-full h-full">
        
        <!-- Player Controls Header (Floating) -->
        <div class="absolute top-0 left-0 w-full z-20 bg-gradient-to-b from-black/90 via-black/50 to-transparent pt-4 pb-12 px-4 transition-opacity duration-300" id="playerControls">
            <div class="flex items-center justify-between">
                <!-- Tombol "Mode Penuh" (Visual Only) -->
                <button onclick="app.maximizeView()" class="bg-white/10 hover:bg-white/20 text-white rounded-full px-3 py-1.5 text-xs font-medium flex items-center gap-2 backdrop-blur transition-colors border border-white/10">
                    <i class="fas fa-expand"></i> <span class="hidden sm:inline">Full Screen</span>
                </button>
                
                <h2 class="text-white font-bold text-sm tracking-wide drop-shadow-md" id="playerChannelName">CHANNEL</h2>

                <!-- Tombol Buka Tab Baru -->
                <a id="externalLinkBtn" href="#" target="_blank" class="text-white/80 hover:text-white bg-white/10 hover:bg-white/20 rounded-full w-8 h-8 flex items-center justify-center backdrop-blur transition-colors">
                    <i class="fas fa-external-link-alt text-xs"></i>
                </a>
            </div>
        </div>
        
        <!-- Tap Area untuk Show/Hide Controls -->
        <div id="videoTapArea" class="flex-grow relative w-full h-full bg-black cursor-pointer" onclick="app.toggleControls()">
            <iframe 
                id="tvFrame" 
                src="" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                webkitallowfullscreen
                mozallowfullscreen
                allowfullscreen
                scrolling="no"
                frameborder="0">
            </iframe>
            
            <div id="playerLoading" class="absolute inset-0 flex flex-col items-center justify-center bg-black z-10">
                <div class="loader mb-3"></div>
                <p class="text-slate-500 text-xs">Menyiapkan sinyal...</p>
            </div>
        </div>

        <!-- Bottom Sheet Info -->
        <div class="bg-slate-900/95 backdrop-blur border-t border-slate-800 p-4 pb-6 z-20 rounded-t-2xl">
            <div class="w-10 h-1 bg-slate-700 rounded-full mx-auto mb-3"></div>
            <div class="flex justify-between items-start">
                <div>
                    <h3 class="text-white font-bold text-sm" id="playerTitleDetail">Live TV</h3>
                    <p class="text-slate-400 text-xs mt-1" id="playerDesc">Deskripsi channel...</p>
                </div>
                <button onclick="app.closePlayer()" class="bg-red-500/20 hover:bg-red-500 text-red-400 hover:text-white px-4 py-2 rounded-lg text-xs font-bold transition-colors border border-red-500/30 flex items-center">
                    <i class="fas fa-times mr-1"></i> Tutup
                </button>
            </div>
            <p class="text-[10px] text-center text-slate-600 mt-4 italic">Jika video hitam, klik tombol pojok kanan atas atau cek koneksi.</p>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const app = {
            channels: [
                { id: 'rcti', name: 'RCTI', group: 'MNC', bg: 'bg-blue-600', icon: 'fas fa-tv', url: 'https://sindikasi.inews.id/embed/video/YWdlbnQ9ZGVza3RvcCZ1cmw9aHR0cHMlM0ElMkYlMkZlbWJlZC5yY3RpcGx1cy5jb20lMkZsaXZlJTJGcmN0aSUyRmluZXdzaWQmaGVpZ2h0PTEwMCUyNSZ3aWR0aD0xMDAlMjU=', desc: 'Sinetron & Hiburan' },
                { id: 'gtv', name: 'GTV', group: 'MNC', bg: 'bg-green-600', icon: 'fas fa-bolt', url: 'https://sindikasi.inews.id/embed/video/YWdlbnQ9ZGVza3RvcCZ1cmw9aHR0cHMlM0ElMkYlMkZlbWJlZC5yY3RpcGx1cy5jb20lMkZsaXZlJTJGZ3R2JTJGaW5ld3NpZCZoZWlnaHQ9MTAwJTI1JndpZHRoPTEwMCUyNQ==', desc: 'Global Televisi' },
                { id: 'inews', name: 'iNews', group: 'MNC', bg: 'bg-orange-600', icon: 'fas fa-newspaper', url: 'https://sindikasi.inews.id/embed/video/YWdlbnQ9ZGVza3RvcCZ1cmw9aHR0cHMlM0ElMkYlMkZlbWJlZC5yY3RpcGx1cy5jb20lMkZsaXZlJTJGaW5ld3MlMkZpbmV3c2lkJmhlaWdodD0xMDAlMjUmd2lkdGg9MTAwJTI1', desc: 'Berita Terkini' },
                { id: 'mnctv', name: 'MNCTV', group: 'MNC', bg: 'bg-yellow-500', icon: 'fas fa-star', url: 'https://sindikasi.inews.id/embed/video/YWdlbnQ9ZGVza3RvcCZ1cmw9aHR0cHMlM0ElMkYlMkZlbWJlZC5yY3RpcGx1cy5jb20lMkZsaXZlJTJGbW5jdHYlMkZpbmV3c2lkJmhlaWdodD0xMDAlMjUmd2lkdGg9MTAwJTI1', desc: 'Keluarga & Olahraga' },
                { id: 'idx', name: 'IDX Channel', group: 'Biz', bg: 'bg-slate-700', icon: 'fas fa-chart-line', url: 'https://sindikasi.inews.id/embed/video/YWdlbnQ9ZGVza3RvcCZ1cmw9aHR0cHMlM0ElMkYlMkZjZG4tbGl2ZXR2LXN0dWRpby5tZXR1YmUuaWQlMkZpZHhjaGFubmVsLm0zdTgmaGVpZ2h0PTEwMCUyNSZ3aWR0aD0xMDAlMjU=', desc: 'Pasar Saham' },
                { id: 'mncnews', name: 'MNC News', group: 'News', bg: 'bg-red-700', icon: 'fas fa-globe-asia', url: 'https://sindikasi.inews.id/embed/video/YWdlbnQ9ZGVza3RvcCZ1cmw9aHR0cHMlM0ElMkYlMkZjZG4tbGl2ZXR2LXN0dWRpby5tZXR1YmUuaWQlMkZtbmNuZXdzLm0zdTgmaGVpZ2h0PTEwMCUyNSZ3aWR0aD0xMDAlMjU=', desc: 'News 24 Jam' },
                { id: 'trans7', name: 'TRANS7', group: 'Trans', bg: 'bg-red-600', icon: 'fas fa-flag', url: 'https://video.detik.com/embed/211001001', desc: 'Olahraga & Hiburan' },  // Update dari detik.com (cek jika berubah)
                { id: 'sctv', name: 'SCTV', group: 'Emtek', bg: 'bg-purple-600', icon: 'fas fa-film', url: 'https://www.vidio.com/embed/204?autoplay=true&player_only=true&livestream=true', desc: 'Sinetron & Berita' },
                { id: 'indosiar', name: 'Indosiar', group: 'Emtek', bg: 'bg-indigo-600', icon: 'fas fa-music', url: 'https://www.vidio.com/embed/205?autoplay=true&player_only=true&livestream=true', desc: 'Dangdut & Sinetron' },
                { id: 'transtv', name: 'Trans TV', group: 'Trans', bg: 'bg-pink-600', icon: 'fas fa-heart', url: 'https://www.vidio.com/embed/203?autoplay=true&player_only=true&livestream=true', desc: 'Hiburan Keluarga' },
                { id: 'antv', name: 'ANTV', group: 'Viva', bg: 'bg-teal-600', icon: 'fas fa-drama', url: 'https://www.vidio.com/embed/206?autoplay=true&player_only=true&livestream=true', desc: 'Drama India & Lokal' },  // Dari vidio.com
                { id: 'tvone', name: 'TVOne', group: 'Viva', bg: 'bg-cyan-600', icon: 'fas fa-microphone', url: 'https://www.vidio.com/embed/207?autoplay=true&player_only=true&livestream=true', desc: 'Berita & Diskusi' },
                { id: 'kompastv', name: 'Kompas TV', group: 'Kompas', bg: 'bg-lime-600', icon: 'fas fa-compass', url: 'https://www.kompas.tv/embed/live', desc: 'Berita & Talkshow' },  // Embed resmi jika ada
                { id: 'metrotv', name: 'Metro TV', group: 'Media', bg: 'bg-amber-600', icon: 'fas fa-city', url: 'https://www.metrotvnews.com/embed/live', desc: 'Berita Metro' },
                { id: 'beritasatu', name: 'BeritaSatu', group: 'News', bg: 'bg-rose-600', icon: 'fas fa-newspaper', url: 'https://www.beritasatu.com/embed/live', desc: 'Berita Nasional' },
                { id: 'cnnindonesia', name: 'CNN Indonesia', group: 'CNN', bg: 'bg-red-500', icon: 'fas fa-globe', url: 'https://live.cnnindonesia.com/embed', desc: 'Berita Internasional' },
                { id: 'cnbcindonesia', name: 'CNBC Indonesia', group: 'CNBC', bg: 'bg-green-500', icon: 'fas fa-dollar-sign', url: 'https://www.cnbcindonesia.com/embed/live', desc: 'Ekonomi & Bisnis' },
                { id: 'net', name: 'NET TV', group: 'NET', bg: 'bg-violet-600', icon: 'fas fa-network-wired', url: 'https://www.netmedia.co.id/embed/live', desc: 'Hiburan Modern' },
                { id: 'rtv', name: 'RTV', group: 'Rajawali', bg: 'bg-emerald-600', icon: 'fas fa-child', url: 'https://www.rtv.co.id/embed/live', desc: 'Anak & Keluarga' },
                { id: 'tvri', name: 'TVRI', group: 'Nasional', bg: 'bg-gray-600', icon: 'fas fa-flag-checkered', url: 'https://www.tvri.go.id/live/embed', desc: 'TV Nasional' }
                // Tambah lebih banyak kalau perlu, cek GitHub IPTV untuk update URL
            ],

            proxyUrl: 'https://your-worker-url.workers.dev/?url=',  // GANTI DENGAN URL WORKER-MU

            init() {
                // Jam
                setInterval(() => {
                    const now = new Date();
                    document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});
                }, 1000);
                setTimeout(() => this.renderHome(), 500);
            },

            renderHome() {
                document.getElementById('globalLoader').classList.add('hidden');
                document.getElementById('appContent').classList.remove('opacity-0');
                
                const html = `
                    <div class="space-y-6 animate-fade-in">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            <h2 class="text-white font-bold text-lg">Siaran Langsung</h2>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                            ${this.channels.map(c => `
                                <div onclick="app.playChannel('${c.id}')" class="channel-card bg-card border border-slate-700/50 rounded-xl p-4 flex flex-col items-center justify-center gap-3 aspect-square cursor-pointer relative overflow-hidden group">
                                    <div class="w-12 h-12 rounded-full ${c.bg} flex items-center justify-center text-white text-lg shadow-lg z-10 group-hover:scale-110 transition-transform"><i class="${c.icon}"></i></div>
                                    <h3 class="text-white font-bold text-sm z-10">${c.name}</h3>
                                    <p class="text-slate-500 text-[10px] z-10">${c.group}</p>
                                    <!-- Play Icon Overlay -->
                                    <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all bg-black/20 backdrop-blur-[2px]">
                                        <div class="w-10 h-10 bg-white text-black rounded-full flex items-center justify-center"><i class="fas fa-play ml-1"></i></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                document.getElementById('appContent').innerHTML = html;
            },

            playChannel(id) {
                const ch = this.channels.find(c => c.id === id);
                if (!ch) return;

                const overlay = document.getElementById('playerOverlay');
                const frame = document.getElementById('tvFrame');
                const loading = document.getElementById('playerLoading');
                
                // Set Data
                document.getElementById('playerChannelName').innerText = ch.name;
                document.getElementById('playerTitleDetail').innerText = ch.name;
                document.getElementById('playerDesc').innerText = ch.desc;
                document.getElementById('externalLinkBtn').href = ch.url;

                // Show Overlay
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
                
                // Kunci scroll body
                document.body.classList.add('no-scroll');

                loading.classList.remove('hidden');

                // Gunakan proxy untuk bypass detection
                frame.src = this.proxyUrl + encodeURIComponent(ch.url);

                // Simulasi loading
                setTimeout(() => {
                    loading.classList.add('hidden');
                    // Sembunyikan kontrol otomatis setelah 3 detik
                    document.getElementById('playerControls').style.opacity = '0';
                }, 2000);
            },

            closePlayer() {
                const overlay = document.getElementById('playerOverlay');
                const frame = document.getElementById('tvFrame');
                
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
                frame.src = ''; // Stop stream
                
                // Kembalikan scroll body
                document.body.classList.remove('no-scroll');
                
                // Reset kontrol opacity
                document.getElementById('playerControls').style.opacity = '1';
            },

            toggleControls() {
                const ctrls = document.getElementById('playerControls');
                if (ctrls.style.opacity === '0') {
                    ctrls.style.opacity = '1';
                    setTimeout(() => {
                        ctrls.style.opacity = '0';
                    }, 3000);
                } else {
                    ctrls.style.opacity = '0';
                }
            },

            maximizeView() {
                document.getElementById('playerOverlay').classList.remove('hidden');
                document.getElementById('playerOverlay').classList.add('flex');
                document.getElementById('playerControls').style.opacity = '0';
                this.showToast("Mode Layar Penuh Aktif. Putar HP ke samping untuk optimal.");
            },

            goHome() {
                window.scrollTo({top:0, behavior:'smooth'});
            },

            showToast(msg) {
                const t = document.getElementById('toast');
                document.getElementById('toastMsg').innerText = msg;
                t.classList.remove('translate-y-20', 'opacity-0');
                setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
